<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CerebroCortex</title>
<style>
:root {
  --bg-deep: #0a0a1a;
  --bg-main: #0f0f1a;
  --bg-surface: #1a1a2e;
  --bg-hover: #22223a;
  --gold: #D4AF37;
  --gold-bright: #FFD700;
  --gold-dim: #B8960B;
  --text: #e0e0e0;
  --text-muted: #888;
  --green: #4ade80;
  --amber: #fbbf24;
  --red: #f87171;
  --blue: #60a5fa;
  --purple: #a78bfa;
  --radius: 8px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg-main); color: var(--text);
  display: flex; min-height: 100vh;
}

/* Sidebar */
.sidebar {
  width: 220px; background: var(--bg-deep); border-right: 1px solid #222;
  display: flex; flex-direction: column; position: fixed; top: 0; bottom: 0;
  z-index: 100;
}
.sidebar-brand {
  padding: 20px 16px; border-bottom: 1px solid #222;
  font-size: 18px; font-weight: 700; color: var(--gold);
}
.sidebar-brand small { display: block; font-size: 11px; color: var(--text-muted); font-weight: 400; }
.sidebar nav { flex: 1; padding: 12px 0; }
.sidebar nav a {
  display: block; padding: 10px 20px; color: var(--text-muted); text-decoration: none;
  font-size: 14px; transition: all 0.2s;
}
.sidebar nav a:hover { color: var(--text); background: var(--bg-hover); }
.sidebar nav a.active { color: var(--gold); border-left: 3px solid var(--gold); background: var(--bg-surface); }
.sidebar-footer {
  padding: 12px 16px; border-top: 1px solid #222; font-size: 12px; color: var(--text-muted);
  display: flex; align-items: center; gap: 8px;
}
.health-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--green); }

/* Main */
.main { margin-left: 220px; flex: 1; padding: 24px 32px; min-height: 100vh; }

/* Cards */
.card {
  background: var(--bg-surface); border-radius: var(--radius); padding: 20px;
  margin-bottom: 16px; border: 1px solid #222;
}
.card h3 { color: var(--gold); margin-bottom: 12px; font-size: 15px; }

/* Stat cards */
.stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 20px; }
.stat-card {
  background: var(--bg-surface); border-radius: var(--radius); padding: 16px;
  text-align: center; border-top: 3px solid var(--gold); border: 1px solid #222;
  border-top-color: var(--gold);
}
.stat-card .val { font-size: 28px; font-weight: 700; color: var(--gold-bright); }
.stat-card .lbl { font-size: 12px; color: var(--text-muted); margin-top: 4px; }

/* Badges */
.badge {
  display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 11px;
  font-weight: 600; margin-right: 4px;
}
.badge-type { background: #1e3a5f; color: var(--blue); }
.badge-layer { background: #2a1a3e; color: var(--purple); }
.badge-high { background: #3a1a1a; color: var(--red); }
.badge-medium { background: #3a2a1a; color: var(--amber); }
.badge-low { background: #1a2a1a; color: var(--green); }

/* Buttons */
.btn {
  padding: 8px 16px; border-radius: var(--radius); border: 1px solid var(--gold-dim);
  background: transparent; color: var(--gold); cursor: pointer; font-size: 13px;
  transition: all 0.2s;
}
.btn:hover { background: var(--gold-dim); color: #000; }
.btn-primary { background: var(--gold-dim); color: #000; }
.btn-primary:hover { background: var(--gold-bright); }

/* Forms */
input, textarea, select {
  background: var(--bg-deep); border: 1px solid #333; border-radius: var(--radius);
  color: var(--text); padding: 8px 12px; font-size: 13px; width: 100%;
  font-family: inherit;
}
input:focus, textarea:focus, select:focus { outline: none; border-color: var(--gold-dim); }
textarea { resize: vertical; min-height: 60px; }
.form-row { margin-bottom: 12px; }
.form-row label { display: block; font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }
.form-inline { display: flex; gap: 8px; align-items: end; }

/* Memory cards */
.mem-card {
  background: var(--bg-deep); border-radius: var(--radius); padding: 14px;
  margin-bottom: 10px; border-left: 3px solid var(--gold-dim);
}
.mem-card .meta { display: flex; gap: 6px; align-items: center; margin-bottom: 6px; flex-wrap: wrap; }
.mem-card .content { font-size: 13px; line-height: 1.5; white-space: pre-wrap; color: var(--text); }
.mem-card .score { font-size: 12px; color: var(--gold); margin-left: auto; }
.mem-card .id { font-size: 11px; color: var(--text-muted); margin-top: 6px; font-family: 'Fira Code', monospace; }

/* Tabs */
.tab { display: none; }
.tab.active { display: block; }

/* Toast */
.toast {
  position: fixed; bottom: 20px; right: 20px; padding: 12px 20px;
  background: var(--bg-surface); border: 1px solid var(--gold-dim); border-radius: var(--radius);
  color: var(--text); font-size: 13px; z-index: 999; animation: fadeIn 0.3s;
}
.toast.error { border-color: var(--red); }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Table */
table { width: 100%; border-collapse: collapse; }
th, td { padding: 8px 12px; text-align: left; font-size: 13px; border-bottom: 1px solid #222; }
th { color: var(--text-muted); font-weight: 600; font-size: 12px; }

/* Bar chart */
.bar-row { display: flex; align-items: center; margin-bottom: 6px; }
.bar-label { width: 120px; font-size: 12px; color: var(--text-muted); }
.bar-track { flex: 1; height: 20px; background: var(--bg-deep); border-radius: 4px; overflow: hidden; }
.bar-fill { height: 100%; background: linear-gradient(90deg, var(--gold-dim), var(--gold)); border-radius: 4px; transition: width 0.5s; }
.bar-value { width: 50px; text-align: right; font-size: 12px; color: var(--text); }

/* Responsive */
.mobile-header { display: none; }
@media (max-width: 768px) {
  .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
  .sidebar.open { transform: translateX(0); }
  .main { margin-left: 0; padding: 16px; }
  .mobile-header {
    display: flex; align-items: center; padding: 12px 16px;
    background: var(--bg-deep); border-bottom: 1px solid #222; gap: 12px;
  }
  .hamburger { background: none; border: none; color: var(--gold); font-size: 24px; cursor: pointer; }
  .stat-grid { grid-template-columns: 1fr 1fr; }
}
</style>
</head>
<body>

<div class="mobile-header">
  <button class="hamburger" onclick="document.querySelector('.sidebar').classList.toggle('open')">&#9776;</button>
  <span style="color:var(--gold);font-weight:700">CerebroCortex</span>
</div>

<div class="sidebar">
  <div class="sidebar-brand">
    CerebroCortex
    <small>Brain-Analogous Memory</small>
  </div>
  <nav>
    <a href="#" class="active" onclick="switchTab('dashboard')">Dashboard</a>
    <a href="#" onclick="switchTab('memory')">Memory Explorer</a>
    <a href="#" onclick="switchTab('sessions')">Sessions</a>
    <a href="#" onclick="switchTab('agents')">Agents</a>
    <a href="#" onclick="switchTab('health')">Health</a>
    <a href="#" onclick="switchTab('graph')">Graph</a>
  </nav>
  <div class="sidebar-footer">
    <div class="health-dot" id="healthDot"></div>
    <span id="healthLabel">Loading...</span>
  </div>
</div>

<div class="main">

<!-- ==================== DASHBOARD ==================== -->
<div class="tab active" id="tab-dashboard">
  <h2 style="color:var(--gold);margin-bottom:20px">Dashboard</h2>
  <div class="stat-grid" id="dashStats"></div>

  <div class="card">
    <h3>Memory Distribution</h3>
    <div id="typeChart"></div>
  </div>

  <div class="card">
    <h3>Layer Distribution</h3>
    <div id="layerChart"></div>
  </div>

  <div class="card">
    <h3>Quick Search</h3>
    <div class="form-inline">
      <input id="quickQuery" placeholder="Search memories..." onkeydown="if(event.key==='Enter')quickSearch()">
      <button class="btn btn-primary" onclick="quickSearch()">Search</button>
    </div>
    <div id="quickResults" style="margin-top:12px"></div>
  </div>
</div>

<!-- ==================== MEMORY EXPLORER ==================== -->
<div class="tab" id="tab-memory">
  <h2 style="color:var(--gold);margin-bottom:20px">Memory Explorer</h2>

  <div class="card">
    <h3>Search Memories</h3>
    <div class="form-inline" style="margin-bottom:12px">
      <input id="memQuery" placeholder="Search query..." style="flex:2">
      <select id="memType" style="flex:1">
        <option value="">All types</option>
        <option value="episodic">Episodic</option>
        <option value="semantic">Semantic</option>
        <option value="procedural">Procedural</option>
        <option value="affective">Affective</option>
        <option value="prospective">Prospective</option>
        <option value="schematic">Schematic</option>
      </select>
      <input id="memN" type="number" value="10" min="1" max="50" style="flex:0 0 60px">
      <button class="btn btn-primary" onclick="searchMemory()">Search</button>
    </div>
    <div id="memResults"></div>
  </div>

  <div class="card">
    <h3>Store New Memory</h3>
    <div class="form-row">
      <label>Content</label>
      <textarea id="storeContent" rows="3" placeholder="Memory content..."></textarea>
    </div>
    <div class="form-inline">
      <div class="form-row" style="flex:1">
        <label>Type</label>
        <select id="storeType">
          <option value="">Auto-detect</option>
          <option value="semantic">Semantic</option>
          <option value="episodic">Episodic</option>
          <option value="procedural">Procedural</option>
          <option value="affective">Affective</option>
          <option value="prospective">Prospective</option>
          <option value="schematic">Schematic</option>
        </select>
      </div>
      <div class="form-row" style="flex:1">
        <label>Visibility</label>
        <select id="storeVis">
          <option value="shared">Shared</option>
          <option value="private">Private</option>
          <option value="thread">Thread</option>
        </select>
      </div>
      <div class="form-row" style="flex:1">
        <label>Tags (comma-sep)</label>
        <input id="storeTags" placeholder="tag1, tag2">
      </div>
    </div>
    <button class="btn btn-primary" onclick="storeMemory()" style="margin-top:8px">Store Memory</button>
  </div>
</div>

<!-- ==================== SESSIONS ==================== -->
<div class="tab" id="tab-sessions">
  <h2 style="color:var(--gold);margin-bottom:20px">Sessions</h2>
  <div class="form-inline" style="margin-bottom:16px">
    <select id="sessPriority" style="flex:1">
      <option value="">All priorities</option>
      <option value="HIGH">HIGH</option>
      <option value="MEDIUM">MEDIUM</option>
      <option value="LOW">LOW</option>
    </select>
    <select id="sessHours" style="flex:1">
      <option value="24">Last 24h</option>
      <option value="168" selected>Last week</option>
      <option value="720">Last month</option>
    </select>
    <button class="btn btn-primary" onclick="loadSessions()">Load</button>
  </div>
  <div id="sessResults"></div>
</div>

<!-- ==================== AGENTS ==================== -->
<div class="tab" id="tab-agents">
  <h2 style="color:var(--gold);margin-bottom:20px">Agents</h2>
  <div id="agentList"></div>

  <div class="card" style="margin-top:20px">
    <h3>Register Agent</h3>
    <div class="form-inline">
      <div class="form-row" style="flex:1">
        <label>Agent ID</label>
        <input id="regId" placeholder="AGENT_ID">
      </div>
      <div class="form-row" style="flex:1">
        <label>Display Name</label>
        <input id="regName" placeholder="Agent Name">
      </div>
      <div class="form-row" style="flex:1">
        <label>Specialization</label>
        <input id="regSpec" placeholder="What it does">
      </div>
    </div>
    <div class="form-inline">
      <div class="form-row" style="flex:1">
        <label>Lineage</label>
        <input id="regLineage" placeholder="Group">
      </div>
      <div class="form-row" style="flex:0 0 80px">
        <label>Symbol</label>
        <input id="regSymbol" placeholder="A" maxlength="2">
      </div>
      <div class="form-row" style="flex:0 0 100px">
        <label>Generation</label>
        <input id="regGen" type="number" value="0">
      </div>
    </div>
    <button class="btn btn-primary" onclick="registerAgent()" style="margin-top:8px">Register</button>
  </div>
</div>

<!-- ==================== HEALTH ==================== -->
<div class="tab" id="tab-health">
  <h2 style="color:var(--gold);margin-bottom:20px">Health</h2>
  <div id="healthReport"></div>
</div>

<!-- ==================== GRAPH ==================== -->
<div class="tab" id="tab-graph">
  <h2 style="color:var(--gold);margin-bottom:20px">Graph Explorer</h2>
  <div class="card">
    <h3>Graph Statistics</h3>
    <div id="graphStats"></div>
  </div>
  <div class="card">
    <h3>Neighbors</h3>
    <div class="form-inline" style="margin-bottom:12px">
      <input id="neighborId" placeholder="Memory ID..." style="flex:2">
      <button class="btn btn-primary" onclick="loadNeighbors()">Find Neighbors</button>
    </div>
    <div id="neighborResults"></div>
  </div>
</div>

</div><!-- .main -->

<script>
const API = window.location.origin;

function esc(s) {
  const d = document.createElement('div');
  d.textContent = s || '';
  return d.innerHTML;
}

function timeAgo(iso) {
  const d = new Date(iso);
  const s = Math.floor((Date.now() - d) / 1000);
  if (s < 60) return s + 's ago';
  if (s < 3600) return Math.floor(s/60) + 'm ago';
  if (s < 86400) return Math.floor(s/3600) + 'h ago';
  return Math.floor(s/86400) + 'd ago';
}

function toast(msg, err) {
  const t = document.createElement('div');
  t.className = 'toast' + (err ? ' error' : '');
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(() => t.remove(), 3500);
}

async function api(path, opts) {
  try {
    const r = await fetch(API + path, opts);
    if (!r.ok) {
      const e = await r.json().catch(() => ({}));
      throw new Error(e.detail || r.statusText);
    }
    return await r.json();
  } catch (e) {
    toast(e.message, true);
    throw e;
  }
}

function switchTab(name) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.sidebar nav a').forEach(a => a.classList.remove('active'));
  const tab = document.getElementById('tab-' + name);
  if (tab) tab.classList.add('active');
  const nav = document.querySelectorAll('.sidebar nav a');
  nav.forEach(a => { if (a.textContent.toLowerCase().includes(name.substring(0,4))) a.classList.add('active'); });
  document.querySelector('.sidebar').classList.remove('open');

  if (name === 'dashboard') loadDashboard();
  if (name === 'sessions') loadSessions();
  if (name === 'agents') loadAgents();
  if (name === 'health') loadHealth();
  if (name === 'graph') loadGraphStats();
}

function barChart(container, data, maxVal) {
  if (!maxVal) maxVal = Math.max(...Object.values(data), 1);
  let html = '';
  for (const [k, v] of Object.entries(data)) {
    const pct = Math.round((v / maxVal) * 100);
    html += `<div class="bar-row">
      <div class="bar-label">${esc(k)}</div>
      <div class="bar-track"><div class="bar-fill" style="width:${pct}%"></div></div>
      <div class="bar-value">${v}</div>
    </div>`;
  }
  container.innerHTML = html;
}

function memCard(m) {
  const tags = (m.tags || []).map(t => `<span class="badge badge-type">${esc(t)}</span>`).join('');
  return `<div class="mem-card">
    <div class="meta">
      <span class="badge badge-type">${esc(m.type)}</span>
      <span class="badge badge-layer">${esc(m.layer || '')}</span>
      ${m.score !== undefined ? `<span class="score">${(m.score * 100).toFixed(1)}%</span>` : ''}
    </div>
    <div class="content">${esc(m.content)}</div>
    <div style="margin-top:6px">${tags}</div>
    <div class="id">${esc(m.id)} ${m.created_at ? '| ' + timeAgo(m.created_at) : ''}</div>
  </div>`;
}

// ==================== Dashboard ====================
async function loadDashboard() {
  try {
    const [s, h] = await Promise.all([api('/stats'), api('/health')]);

    document.getElementById('dashStats').innerHTML = `
      <div class="stat-card"><div class="val">${s.nodes}</div><div class="lbl">Memories</div></div>
      <div class="stat-card"><div class="val">${s.links}</div><div class="lbl">Links</div></div>
      <div class="stat-card"><div class="val">${s.episodes}</div><div class="lbl">Episodes</div></div>
      <div class="stat-card"><div class="val">${s.schemas}</div><div class="lbl">Schemas</div></div>
      <div class="stat-card"><div class="val">${h.pending_intentions}</div><div class="lbl">Intentions</div></div>
    `;

    barChart(document.getElementById('typeChart'), s.memory_types || {});
    barChart(document.getElementById('layerChart'), s.layers || {});

    document.getElementById('healthDot').style.background = 'var(--green)';
    document.getElementById('healthLabel').textContent = `${s.nodes} memories`;
  } catch (e) {
    document.getElementById('healthDot').style.background = 'var(--red)';
    document.getElementById('healthLabel').textContent = 'Error';
  }
}

async function quickSearch() {
  const q = document.getElementById('quickQuery').value.trim();
  if (!q) return;
  const data = await api(`/q/${encodeURIComponent(q)}?n=5`);
  document.getElementById('quickResults').innerHTML =
    data.results.map(m => memCard(m)).join('') || '<p style="color:var(--text-muted)">No results</p>';
}

// ==================== Memory Explorer ====================
async function searchMemory() {
  const q = document.getElementById('memQuery').value.trim();
  if (!q) return;
  const body = {
    query: q,
    top_k: parseInt(document.getElementById('memN').value) || 10,
  };
  const t = document.getElementById('memType').value;
  if (t) body.memory_types = [t];

  const data = await api('/recall', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(body),
  });

  document.getElementById('memResults').innerHTML =
    `<p style="color:var(--text-muted);margin-bottom:8px">Found ${data.count} memories</p>` +
    data.results.map(m => memCard(m)).join('') || '<p style="color:var(--text-muted)">No results</p>';
}

async function storeMemory() {
  const content = document.getElementById('storeContent').value.trim();
  if (!content) { toast('Content required', true); return; }

  const body = {
    content,
    visibility: document.getElementById('storeVis').value,
  };
  const t = document.getElementById('storeType').value;
  if (t) body.memory_type = t;
  const tags = document.getElementById('storeTags').value.trim();
  if (tags) body.tags = tags.split(',').map(s => s.trim()).filter(Boolean);

  const data = await api('/remember', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(body),
  });

  if (data.stored) {
    toast('Memory stored: ' + data.id);
    document.getElementById('storeContent').value = '';
    document.getElementById('storeTags').value = '';
  } else {
    toast('Memory gated out: ' + (data.reason || 'unknown'), true);
  }
}

// ==================== Sessions ====================
async function loadSessions() {
  const priority = document.getElementById('sessPriority').value;
  const hours = document.getElementById('sessHours').value;
  let url = `/sessions?lookback_hours=${hours}&limit=20`;
  if (priority) url += `&priority=${priority}`;

  const data = await api(url);
  if (!data.sessions.length) {
    document.getElementById('sessResults').innerHTML = '<p style="color:var(--text-muted)">No session notes found.</p>';
    return;
  }

  document.getElementById('sessResults').innerHTML = data.sessions.map(s => {
    const priBadge = s.priority === 'HIGH' ? 'badge-high' : s.priority === 'LOW' ? 'badge-low' : 'badge-medium';
    return `<div class="mem-card">
      <div class="meta">
        <span class="badge ${priBadge}">${esc(s.priority)}</span>
        <span class="badge badge-type">${esc(s.session_type)}</span>
        <span style="font-size:12px;color:var(--text-muted)">${timeAgo(s.created_at)}</span>
      </div>
      <div class="content">${esc(s.content)}</div>
      <div class="id">${esc(s.id)}</div>
    </div>`;
  }).join('');
}

// ==================== Agents ====================
async function loadAgents() {
  const data = await api('/agents');
  if (!data.agents.length) {
    document.getElementById('agentList').innerHTML = '<p style="color:var(--text-muted)">No agents registered.</p>';
    return;
  }

  document.getElementById('agentList').innerHTML = data.agents.map(a => `
    <div class="mem-card">
      <div class="meta">
        <span style="font-size:24px;color:${esc(a.color)};margin-right:8px">${esc(a.symbol)}</span>
        <strong>${esc(a.display_name)}</strong>
        <span class="badge badge-type">${esc(a.id)}</span>
        <span style="font-size:12px;color:var(--text-muted)">Gen ${a.generation}</span>
      </div>
      <div class="content">${esc(a.lineage)} | ${esc(a.specialization)}</div>
    </div>
  `).join('');
}

async function registerAgent() {
  const id = document.getElementById('regId').value.trim();
  const name = document.getElementById('regName').value.trim();
  if (!id || !name) { toast('Agent ID and name required', true); return; }

  await api('/agents', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      agent_id: id,
      display_name: name,
      specialization: document.getElementById('regSpec').value.trim(),
      lineage: document.getElementById('regLineage').value.trim(),
      symbol: document.getElementById('regSymbol').value.trim() || 'A',
      generation: parseInt(document.getElementById('regGen').value) || 0,
    }),
  });
  toast('Agent registered: ' + id);
  loadAgents();
}

// ==================== Health ====================
async function loadHealth() {
  const data = await api('/memory/health');
  let html = `
    <div class="stat-grid">
      <div class="stat-card"><div class="val">${data.memories}</div><div class="lbl">Memories</div></div>
      <div class="stat-card"><div class="val">${data.links}</div><div class="lbl">Links</div></div>
      <div class="stat-card"><div class="val">${data.episodes}</div><div class="lbl">Episodes</div></div>
      <div class="stat-card"><div class="val">${data.schemas}</div><div class="lbl">Schemas</div></div>
      <div class="stat-card"><div class="val">${data.pending_intentions}</div><div class="lbl">Pending Intentions</div></div>
    </div>
    <div class="card"><h3>By Type</h3><div id="healthTypeChart"></div></div>
    <div class="card"><h3>By Layer</h3><div id="healthLayerChart"></div></div>
  `;

  if (data.promotions && Object.keys(data.promotions).length) {
    html += '<div class="card"><h3>Promotions This Check</h3><table>';
    for (const [layer, count] of Object.entries(data.promotions)) {
      html += `<tr><td>${esc(layer)}</td><td>${count}</td></tr>`;
    }
    html += '</table></div>';
  }

  document.getElementById('healthReport').innerHTML = html;
  barChart(document.getElementById('healthTypeChart'), data.by_type || {});
  barChart(document.getElementById('healthLayerChart'), data.by_layer || {});
}

// ==================== Graph ====================
async function loadGraphStats() {
  const data = await api('/graph/stats');
  let html = `
    <div class="stat-grid">
      <div class="stat-card"><div class="val">${data.nodes}</div><div class="lbl">Nodes (SQLite)</div></div>
      <div class="stat-card"><div class="val">${data.links}</div><div class="lbl">Links (SQLite)</div></div>
      <div class="stat-card"><div class="val">${data.igraph_vertices}</div><div class="lbl">Vertices (igraph)</div></div>
      <div class="stat-card"><div class="val">${data.igraph_edges}</div><div class="lbl">Edges (igraph)</div></div>
    </div>
    <div style="margin-top:16px"><h3 style="color:var(--gold);margin-bottom:8px">Link Types</h3></div>
  `;

  const ltDiv = document.createElement('div');
  document.getElementById('graphStats').innerHTML = html;
  const chartEl = document.createElement('div');
  document.getElementById('graphStats').appendChild(chartEl);
  barChart(chartEl, data.link_types || {});
}

async function loadNeighbors() {
  const id = document.getElementById('neighborId').value.trim();
  if (!id) return;
  const data = await api(`/graph/neighbors/${encodeURIComponent(id)}`);
  if (!data.neighbors.length) {
    document.getElementById('neighborResults').innerHTML = '<p style="color:var(--text-muted)">No neighbors found.</p>';
    return;
  }

  document.getElementById('neighborResults').innerHTML = data.neighbors.map(n => `
    <div class="mem-card">
      <div class="meta">
        <span class="badge badge-type">${esc(n.link_type)}</span>
        <span class="score">w=${n.weight.toFixed(2)}</span>
      </div>
      <div class="content">${esc(n.content)}</div>
      <div class="id">${esc(n.id)}</div>
    </div>
  `).join('');
}

// ==================== Init ====================
loadDashboard();
</script>
</body>
</html>
